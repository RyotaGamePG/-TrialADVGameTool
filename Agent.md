# AGENTS.md — プロジェクト「Agents（裁判ADVエディタ）」向け機械／AIエージェント指示ファイル

## プロジェクト概要
- このプロジェクトは Unity 上で「捜査 → 裁判」形式の推理アドベンチャーを簡単に組み立てられるエディタツール “Agents” を作るもの。
- 主機能はストーリー進行、証拠収集、裁判／反論システム、立ち絵演出、音声同期、分岐管理など。
- 拡張性・ローコード化・モジュール分離を重視。

## 開発環境／セットアップ
- Unity バージョン：6.0
- 必須パッケージ：Addressables, Timeline, DOTween（または任意）、Cinemachine（カメラ制御用）  
- 推奨エディタ拡張：Visual Studio / Rider  
- クローン後の初期手順：  
  1. `git submodule update --init`（あれば）  
  2. Unity Package をインポート（`Assets/Agents/Packages/…` 等）  
  3. シーン “_Bootstrap.unity” を開き、初期設定を確認  

## ビルド・テスト・実行コマンド
- Unity Editor 内で通常ビルド：`File → Build Settings → Build`  
- エディタ拡張テスト：Unity の Play モードを使ってシミュレーション  
- 自動テスト（Unit / Integration）：NUnit / Unity Test Runner で `Tests` フォルダを実行  


## コードスタイル・命名規約
- C# コード：Microsoft’s C# コーディング規約を基本としつつ、以下を追加  
  - クラス名は PascalCase、メソッド名も PascalCase  
  - フィールド名（private）は `_camelCase`、public は `CamelCase`  
  - 命名にドメイン用語を用いる：`StoryRunner`, `TrialController`, `EvidenceService` など  
  - コメントは XML ドキュメント形式（`/// <summary>…`）を推奨  
  - LINQ は適度に使うが、複雑なクエリは明示的ループで書く方針  

## アーキテクチャ／設計パターン
- モジュール境界を厳格に区切る（例：UI 層 / ロジック層 / サービス層）  
- 依存注入（DI）を部分的に導入、直接 new を使う箇所を最小化  
- イベントバス設計（中央イベントハブ）を採用し、モジュール間の結合度を下げる  
- ScriptableObject をデータ定義用途に使い、ロジックコードには定数参照を避ける  
- 拡張ポイント（IReactionHandler や拡張ノードなど）をインターフェースで用意  

## 制約事項・注意点
- GC 発生を最小化する設計を守ること：頻繁実行部（証言進行・ノード処理など）は new や LINQ を過度に使わない  
- 音声同期・タイミング演出は “オーディオがマスター” の原則を守る  
- プラットフォーム別制約（モバイルなら音声フォーマット、ファイル I/O の制限など）を考慮  
- 秘密鍵や API キーはコードに直書きしない。 `.gitignore` 管理 or 外部設定方式にする  
- パッケージ依存はなるべく少なく。サードパーティを導入する場合はバージョン固定  

## AI エージェントへの指示（自動コード生成時のルール）
- 生成コードは既存命名規約・フォルダ構造に従うこと  
- 既存モジュールやクラスをなるべく再利用し、新規追加は最小限に  
- 自動生成後は必ずユニットテストを追加  
- PR（プルリク）作成時には、AGENTS.md の “テスト通過条件” を満たすこと  
- 生成箇所には必ず `// Generated by agent: YYYY-MM-DD` のようなメタコメントを残す  

## 運用ルール（コミット / PR / チェック）
- コミットメッセージ書式：`[モジュール名] 概要説明`（例：`[Trial] AddReactionWindowLogic`）  
- PR 条件：すべてのユニットテスト通過、スタイルチェック通過  
- 自動チェック：コード整形ツール / Linter を入れる（例：EditorConfig / Roslyn Analyzer）  
- ドキュメント更新：仕様変更時は必ず README.md と AGENTS.md 両方に追記  

## 用語集（ドメイン知識／キーワード）
- **StoryRunner**：シナリオノードを実行し、シーン遷移を制御するコアモジュール  
- **TrialController**：裁判パート（証言進行 → 反論処理 → 判定）を担うモジュール  
- **EvidenceService**：証拠アイテムの管理・提示権限検証  
- **PortraitController**：立ち絵表示・表情切替・カメラ演出連動  
- **ReactionType**：反論 / 偽証 / 賛成 / 追及 / 証拠提示 等の種類  
- **Flag**：ストーリー分岐・条件制御に使う変数  
- **Timeline / Signal**：Unity の映像／音声同期演出用仕組み  

